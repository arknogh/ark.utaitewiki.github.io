
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utacolle Directory</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/js/jquery.dataTables.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/datatables/1.10.21/css/jquery.dataTables.min.css">
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">Utacolle Directory</h1>
        
        <div class="bg-white rounded-lg shadow p-6">
            <table id="directoryTable" class="w-full">
                <thead>
                    <tr>
                        <th>Season</th>
                        <th>Link</th>
                        <th>Last Modified</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            async function scanDirectory() {
                try {
                    const response = await fetch('./utacolle/');
                    const text = await response.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const files = Array.from(doc.querySelectorAll('a'))
                        .filter(a => a.href.endsWith('.html'))
                        .map(a => {
                            const filename = a.href.split('/').pop();
                            const season = filename.replace('.html', '')
                                .replace(/(\d{4})/, ' $1')
                                .replace(/^[a-z]/, str => str.toUpperCase());
                            return {
                                season: season,
                                filename: filename,
                                lastModified: new Date(a.nextSibling.textContent).toLocaleDateString()
                            };
                        });

                    $('#directoryTable').DataTable({
                        data: files,
                        columns: [
                            { data: 'season' },
                            { 
                                data: 'filename',
                                render: function(data, type, row) {
                                    return `<a href="./utacolle/${data}" class="text-blue-600 hover:text-blue-800">${row.season}</a>`;
                                }
                            },
                            { data: 'lastModified' }
                        ],
                        order: [[0, 'desc']],
                        pageLength: 10,
                        searching: true,
                        info: true
                    });
                } catch (error) {
                    toastr.error('Error scanning directory');
                    console.error('Error:', error);
                }
            }

            scanDirectory();
        });
    </script>
</body>
</html>
